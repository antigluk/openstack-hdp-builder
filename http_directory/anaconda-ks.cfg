# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
cdrom
text
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw --plaintext hadoop
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --disabled
timezone --utc America/Chicago
bootloader --location=mbr --driveorder=sda --append="crashkernel=auto rhgb quiet"

# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work

# Clean out the old disk config
zerombr

# Clean out old partitions
clearpart --all --drives=sda

part swap --size=2048
part / --fstype ext4  --size=1 --grow


# Location of the package data
#url --url ftp://mirrors.loosefoot.com/centos/6.4/os/x86_64/
repo --name=os-extra --baseurl=ftp://mirrors.loosefoot.com/centos/6.4/os/x86_64/
repo --name=epel --baseurl=http://download.fedoraproject.org/pub/epel/6/x86_64/
repo --name=updates --baseurl=http://mirrors.usinternet.com/centos/6.4/updates/x86_64/
repo --name=ambari --baseurl=http://public-repo-1.hortonworks.com/ambari/centos6/1.x/GA
repo --name=ambari-updates --baseurl=http://public-repo-1.hortonworks.com/ambari/centos6/1.x/updates
repo --name=hdp-utils --baseurl=http://public-repo-1.hortonworks.com/HDP-UTILS-1.1.0.15/repos/centos6

%packages --nobase
	@core

	openssh-clients

	#useful tools
	nano
	htop
	wget

	#cloud tools
	cloud-init
	cloud-utils

%end

%post

	# Change to a vt to see progress

	exec < /dev/tty3 > /dev/tty3
	chvt 3

	(
		#######################################################
		# Turn off un-needed services
		#######################################################
		chkconfig vbox-add-x11 off
		chkconfig smartd off
		chkconfig cupsd off

		groupadd admin
		useradd -g admin stack
		#echo 'Defaults env_keep="SSH_AUTH_SOCK"' >> /etc/sudoers
		echo '%admin    ALL=(ALL) ALL' >> /etc/sudoers

		########################################################
		# Cleanup for compression
		#######################################################
		# Remove ruby build libs
		yum -y remove zlib-devel openssl-devel readline-devel
		
		# Cleanup other files we do not need
		yum -y groupremove "Dialup Networking Support" Editors "Printing Support" "Additional Development" "E-mail server"
	) 2>&1 | /usr/bin/tee /root/ks-post.log

	# switch back to gui
	chvt 7

%end

reboot
